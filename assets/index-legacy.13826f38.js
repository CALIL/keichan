!function(){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,r){return(e=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,r)}function r(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,i=n(t);if(e){var a=n(this).constructor;r=Reflect.construct(i,arguments,a)}else r=i.apply(this,arguments);return o(this,r)}}function o(e,r){return!r||"object"!==t(r)&&"function"!=typeof r?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(e):r}function n(t){return(n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function i(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return a(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return a(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var o=0,n=function(){};return{s:n,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,l=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return s=t.done,t},e:function(t){l=!0,i=t},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw i}}}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,o=new Array(e);r<e;r++)o[r]=t[r];return o}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function c(t,e,r){return e&&l(t.prototype,e),r&&l(t,r),t}function u(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var d=document.createElement("style");d.innerHTML='@charset "UTF-8";*{box-sizing:border-box;margin:0;padding:0}body,html{width:100%;height:100%;font-family:"Hiragino Kaku Gothic Pro","ヒラギノ角ゴ Pro W3","Noto Sans JP","ＭＳ Ｐゴシック","Helvetica Neue",Helvetica,Arial,sans-serif}#app{margin:0 auto}#app header{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem}#app header form input{width:300px;height:3rem;padding:.5rem 1rem;border:1px solid #cccCCCCC;border-top-left-radius:5px;border-bottom-left-radius:5px}#app header form button{height:3rem;padding:.3rem 1rem;border-top:1px solid #cccCCCCC;border-right:1px solid #cccCCCCC;border-bottom:1px solid #cccCCCCC;border-left:none;border-top-right-radius:5px;border-bottom-right-radius:5px;cursor:pointer}#app header form button:hover{border-color:#999}#app header .right{display:flex}#app header .right .count{font-size:2rem;font-weight:700;margin-right:1rem}#app header .right button{padding:0 1rem;border:1px solid #cccCCCCC;border-radius:5px;cursor:pointer}#app header .right button:hover{border:1px solid #999}#app .warning{border:1px solid #cccCCCCC;border-radius:10px;padding:1rem;margin-bottom:.5rem}#app .connected{border:1px solid #cccCCCCC;border-radius:10px;padding:1rem;margin-bottom:.5rem}#app .description{text-align:center;background-color:#eee;border:1px solid #cccCCCCC;border-radius:10px;padding:5rem}#app .description svg{display:block;width:75px;margin:0 auto}#app .Spreadsheet__table{width:100%}#app .Spreadsheet__table tr td:first-child,#app .Spreadsheet__table tr th:first-child{width:2rem}#app .Spreadsheet__table tr td:nth-child(2),#app .Spreadsheet__table tr th:nth-child(2){width:3rem!important}#app .Spreadsheet__table tr td:nth-child(3),#app .Spreadsheet__table tr th:nth-child(3){width:3rem!important}#app .Spreadsheet__table tr td:nth-child(4),#app .Spreadsheet__table tr th:nth-child(4){width:5rem!important}#app .Spreadsheet__table tr td:nth-child(5),#app .Spreadsheet__table tr th:nth-child(5){width:5rem!important}#app .books{border-top:1px solid #ccc}#app .books .book{display:flex;justify-content:space-between;align-items:center;padding:1rem 0;border-bottom:1px solid #ccc}#app .books .book .bib{display:flex;align-items:center}#app .books .book .bib img{width:50px;margin-right:1rem}#app .books .book .bib .title{margin-right:1rem}#app .books .book .bib .isbn{font-size:.8rem}#app .books .book button{padding:0 .5rem;border:1px solid #ccc;border-radius:5px;cursor:pointer}#app .books .book button:hover{border:1px solid #999}@keyframes spinner{to{transform:rotate(360deg)}}@keyframes waiting{0%,100%,40%{background-size:32px}20%{background-size:40px}}.suggest{position:absolute;top:95px;z-index:100000;width:90%;background-color:#fff;box-shadow:0 2px 4px #ccc}.suggest .message{font-size:1rem;font-weight:600;color:#999;margin:0;background-color:#fff;padding:5px;border:1px solid #ccc;transition:opacity .6s}.suggest .results{border-bottom:1px solid #ccc;max-height:350px;overflow-y:scroll}.suggest .results .book{display:flex;justify-content:flex-start;align-items:flex-start;background-color:#fff;padding:0;border-top:1px solid #ccc;transition:opacity .6s;height:70px;overflow:hidden}.suggest .results .book:hover{background-color:#c6e5f2;border-bottom:1px solid #08a2e8}.suggest .results .book:hover{background-color:#c6e5f2}.suggest .results .book:hover>.next{color:#08a2e8}.suggest .results .book img{width:60px;margin-right:.5rem;background-color:#fff;background-image:url("https://calil.jp/public/img/no-image/noimage.png");background-size:100%}.suggest .results .book>div{padding:.5rem}.suggest .results .book>div .title{font-size:1rem;line-height:1.2em;font-weight:600;color:#444;text-decoration:none;max-height:2.4em;text-align:left;margin-bottom:.25rem}.suggest .results .book>div .author{font-size:.8rem;font-weight:400}.suggest .loading{top:-5px!important}.suggest .loading svg{display:none}.suggest .loading:before{content:"読み込み中";position:absolute;top:50%;left:50%;width:16px;height:16px;margin-top:-5px;margin-left:-10px}.suggest .loading:not(:required):before{content:"";border-radius:50%;border:2px solid rgba(0,0,0,.3);border-top-color:rgba(0,0,0,.6);animation:spinner .6s linear infinite;-webkit-animation:spinner .6s linear infinite}.hide_suggest .results{display:none}.speech{padding:1rem}.speech svg{width:1rem;height:1rem}',document.head.appendChild(d),System.register(["./vendor-legacy.c3fb38e0.js"],(function(){"use strict";var t,o,n,a,l,d,p;return{setters:[function(e){t=e.u,o=e.l,n=e.r,a=e.a,l=e.R,d=e.S,p=e.b}],execute:function(){function h(e){e=t.nfkc(e).toUpperCase().replace(/[^0-9X]/g,"");var r=o.parse(e);if(r){if(r.isIsbn10())return r.asIsbn10();if(r.isIsbn13())return r.asIsbn13().startsWith("978")?r.asIsbn10():r.asIsbn13()}else{var n=o.parse("978"+e);if(n&&n.isIsbn13())return n.asIsbn10()}return!1}var f=["free","title","author","publisher","isbn","ndc","year_start","year_end","region"];function b(t){return n.get("https://unitrad.calil.jp/v1/"+t)}var m=function(){function t(e,r){s(this,t),u(this,"callback",void 0),u(this,"killed",void 0),u(this,"data",void 0),this.callback=r,this.killed=!1,this.search(e)}return c(t,[{key:"kill",value:function(){this.killed=!0}},{key:"search",value:function(t){var e=this;this.killed||b("search").query(function(t){var e,r={},o=i(f);try{for(o.s();!(e=o.n()).done;){var n=e.value;t.hasOwnProperty(n)&&""!==t[n]&&(r[n]=t[n])}}catch(a){o.e(a)}finally{o.f()}return r}(t)).end((function(r,o){r?setTimeout((function(){return e.search(t)}),1e3):e.receive(o.body)}))}},{key:"polling",value:function(){var t=this;this.killed||b("polling").query({uuid:this.data.uuid,version:this.data.version,diff:1,timeout:10}).end((function(e,r){null===r.body?setTimeout((function(){return t.polling()}),100):t.receive(r.body)}))}},{key:"receive",value:function(t){var e=this;if(!this.killed){if(t.books_diff){for(var r in Array.prototype.push.apply(this.data.books,t.books_diff.insert),t)t.hasOwnProperty(r)&&"books_diff"!==r&&(this.data[r]=t[r]);var o,n=i(t.books_diff.update);try{for(n.s();!(o=n.n()).done;){var a=o.value;for(var s in a)if(a.hasOwnProperty(s)&&"_idx"!==s)if(!0===Array.isArray(a[s]))Array.prototype.push.apply(this.data.books[a._idx][s],a[s]);else if(a[s]instanceof Object)for(var l in a[s])a[s].hasOwnProperty(l)&&(this.data.books[a._idx][s][l]=a[s][l]);else this.data.books[a._idx][s]=a[s]}}catch(c){n.e(c)}finally{n.f()}}else this.data=t;this.callback(this.data),!0===t.running?(console.log("[Unitrad] continue..."),1===t.version&&0===this.data.books.length?setTimeout((function(){return e.polling()}),20):setTimeout((function(){return e.polling()}),500)):console.log("[Unitrad] complete.")}}}]),t}();var g=function(t){!function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&e(t,r)}(n,t);var o=r(n);function n(t){var e;return s(this,n),(e=o.call(this,t)).state={invalidISBN:!1,books:[]},e.timer=null,e.str="",e.prevISBN=null,e.documentCode=null,e}return c(n,[{key:"onKeyDown",value:function(t){var e=this,r=t||window.event,o=r.keyCode||r.which||r.charCode;"Enter"===t.key||13===o?(this.str.length>=10&&(h(this.str)?(this.setState({invalidISBN:!1}),this.addBook(this.str)):(this.setState({invalidISBN:!0}),this.pushTempBook(this.str))),this.timer&&clearTimeout(this.timer),this.str=""):(1===t.key.length?this.str+=t.key:this.str="",this.timer&&clearTimeout(this.timer),this.timer=setTimeout((function(){console.log("clear"),e.str.length>=10&&(h(e.str)?(e.setState({invalidISBN:!1}),e.addBook(e.str)):(e.setState({invalidISBN:!0}),e.pushTempBook(e.str))),e.str=""}),300))}},{key:"componentDidMount",value:function(){window.document.addEventListener("keydown",this.onKeyDown.bind(this))}},{key:"addBook",value:function(t){var e=this;new m({isbn:t,region:"recipe"},(function(t){if(t.count>=1){var r=t.books[0];e.pushBook(r.title,r.isbn)}else console.log("not found")}))}},{key:"pushBook",value:function(t,e){this.prevISBN!==e&&(console.log(this.documentCode),this.documentCode?(this.state.books.shift(),this.state.books.unshift([{value:this.documentCode},{value:t},{value:e},{value:""}]),this.documentCode=null):this.state.books.unshift([{value:e},{value:t},{value:e},{value:""}]),this.setState({}),this.prevISBN=e)}},{key:"pushTempBook",value:function(t){t.startsWith("192")||this.documentCode!==t&&(this.state.books.unshift([{value:t},{value:""},{value:""},{value:""}]),this.setState({}),this.documentCode=t)}},{key:"render",value:function(){return 0===this.state.books.length?l.createElement("div",{className:"description"},l.createElement("div",null,l.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},l.createElement("path",{d:"M0 448V64h18v384H0zm26.857-.273V64H36v383.727h-9.143zm27.143 0V64h8.857v383.727H54zm44.857 0V64h8.857v383.727h-8.857zm36 0V64h17.714v383.727h-17.714zm44.857 0V64h8.857v383.727h-8.857zm18 0V64h8.857v383.727h-8.857zm18 0V64h8.857v383.727h-8.857zm35.715 0V64h18v383.727h-18zm44.857 0V64h18v383.727h-18zm35.999 0V64h18.001v383.727h-18.001zm36.001 0V64h18.001v383.727h-18.001zm26.857 0V64h18v383.727h-18zm45.143 0V64h26.857v383.727h-26.857zm35.714 0V64h9.143v383.727H476zm18 .273V64h18v384h-18z"})),"バーコードをスキャンしてください")):l.createElement(d,{data:this.state.books,columnLabels:["id","title","isbn"]})}}]),n}(a.exports.Component);p.render(l.createElement(g,null),document.getElementById("app"))}}}))}();
