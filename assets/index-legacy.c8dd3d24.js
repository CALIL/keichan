!function(){function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,o){return(t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,o)}function o(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var o,i=n(e);if(t){var s=n(this).constructor;o=Reflect.construct(i,arguments,s)}else o=i.apply(this,arguments);return r(this,o)}}function r(t,o){return!o||"object"!==e(o)&&"function"!=typeof o?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):o}function n(e){return(n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e,t){var o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!o){if(Array.isArray(e)||(o=function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(e);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return s(e,t)}(e))||t&&e&&"number"==typeof e.length){o&&(e=o);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){o=o.call(e)},n:function(){var e=o.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==o.return||o.return()}finally{if(u)throw i}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=new Array(t);o<t;o++)r[o]=e[o];return r}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,o){return t&&u(e.prototype,t),o&&u(e,o),e}function c(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var d=document.createElement("style");d.innerHTML='@charset "UTF-8";*{box-sizing:border-box;margin:0;padding:0}body,html{width:100%;height:100%;font-family:"Hiragino Kaku Gothic Pro","ヒラギノ角ゴ Pro W3","Noto Sans JP","ＭＳ Ｐゴシック","Helvetica Neue",Helvetica,Arial,sans-serif}#app{margin:0 auto}#app header{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem}#app header form input{width:300px;height:3rem;padding:.5rem 1rem;border:1px solid #cccCCCCC;border-top-left-radius:5px;border-bottom-left-radius:5px}#app header form button{height:3rem;padding:.3rem 1rem;border-top:1px solid #cccCCCCC;border-right:1px solid #cccCCCCC;border-bottom:1px solid #cccCCCCC;border-left:none;border-top-right-radius:5px;border-bottom-right-radius:5px;cursor:pointer}#app header form button:hover{border-color:#999}#app header .right{display:flex}#app header .right .count{font-size:2rem;font-weight:700;margin-right:1rem}#app header .right button{padding:0 1rem;border:1px solid #cccCCCCC;border-radius:5px;cursor:pointer}#app header .right button:hover{border:1px solid #999}#app .warning{border:1px solid #cccCCCCC;border-radius:10px;padding:1rem;margin-bottom:.5rem}#app .connected{border:1px solid #cccCCCCC;border-radius:10px;padding:1rem;margin-bottom:.5rem}#app .description{text-align:center;background-color:#eee;border:1px solid #cccCCCCC;border-radius:10px;padding:5rem}#app .description svg{display:block;width:75px;margin:0 auto}#app .Spreadsheet__table{width:100%}#app .books{border-top:1px solid #ccc}#app .books .book{display:flex;justify-content:space-between;align-items:center;padding:1rem 0;border-bottom:1px solid #ccc}#app .books .book .bib{display:flex;align-items:center}#app .books .book .bib img{width:50px;margin-right:1rem}#app .books .book .bib .title{margin-right:1rem}#app .books .book .bib .isbn{font-size:.8rem}#app .books .book button{padding:0 .5rem;border:1px solid #ccc;border-radius:5px;cursor:pointer}#app .books .book button:hover{border:1px solid #999}@keyframes spinner{to{transform:rotate(360deg)}}@keyframes waiting{0%,100%,40%{background-size:32px}20%{background-size:40px}}.suggest{position:absolute;top:95px;z-index:100000;width:90%;background-color:#fff;box-shadow:0 2px 4px #ccc}.suggest .message{font-size:1rem;font-weight:600;color:#999;margin:0;background-color:#fff;padding:5px;border:1px solid #ccc;transition:opacity .6s}.suggest .results{border-bottom:1px solid #ccc;max-height:350px;overflow-y:scroll}.suggest .results .book{display:flex;justify-content:flex-start;align-items:flex-start;background-color:#fff;padding:0;border-top:1px solid #ccc;transition:opacity .6s;height:70px;overflow:hidden}.suggest .results .book:hover{background-color:#c6e5f2;border-bottom:1px solid #08a2e8}.suggest .results .book:hover{background-color:#c6e5f2}.suggest .results .book:hover>.next{color:#08a2e8}.suggest .results .book img{width:60px;margin-right:.5rem;background-color:#fff;background-image:url("https://calil.jp/public/img/no-image/noimage.png");background-size:100%}.suggest .results .book>div{padding:.5rem}.suggest .results .book>div .title{font-size:1rem;line-height:1.2em;font-weight:600;color:#444;text-decoration:none;max-height:2.4em;text-align:left;margin-bottom:.25rem}.suggest .results .book>div .author{font-size:.8rem;font-weight:400}.suggest .loading{top:-5px!important}.suggest .loading svg{display:none}.suggest .loading:before{content:"読み込み中";position:absolute;top:50%;left:50%;width:16px;height:16px;margin-top:-5px;margin-left:-10px}.suggest .loading:not(:required):before{content:"";border-radius:50%;border:2px solid rgba(0,0,0,.3);border-top-color:rgba(0,0,0,.6);animation:spinner .6s linear infinite;-webkit-animation:spinner .6s linear infinite}.hide_suggest .results{display:none}.speech{padding:1rem}.speech svg{width:1rem;height:1rem}',document.head.appendChild(d),System.register(["./vendor-legacy.c3fb38e0.js"],(function(){"use strict";var e,r,n,s,u,d,p;return{setters:[function(t){e=t.u,r=t.l,n=t.r,s=t.a,u=t.R,d=t.S,p=t.b}],execute:function(){function h(t){t=e.nfkc(t).toUpperCase().replace(/[^0-9X]/g,"");var o=r.parse(t);if(o){if(o.isIsbn10())return o.asIsbn10();if(o.isIsbn13())return o.asIsbn13().startsWith("978")?o.asIsbn10():o.asIsbn13()}else{var n=r.parse("978"+t);if(n&&n.isIsbn13())return n.asIsbn10()}return!1}var f=["free","title","author","publisher","isbn","ndc","year_start","year_end","region"];function b(e){return n.get("https://unitrad.calil.jp/v1/"+e)}var g=function(){function e(t,o){a(this,e),c(this,"callback",void 0),c(this,"killed",void 0),c(this,"data",void 0),this.callback=o,this.killed=!1,this.search(t)}return l(e,[{key:"kill",value:function(){this.killed=!0}},{key:"search",value:function(e){var t=this;this.killed||b("search").query(function(e){var t,o={},r=i(f);try{for(r.s();!(t=r.n()).done;){var n=t.value;e.hasOwnProperty(n)&&""!==e[n]&&(o[n]=e[n])}}catch(s){r.e(s)}finally{r.f()}return o}(e)).end((function(o,r){o?setTimeout((function(){return t.search(e)}),1e3):t.receive(r.body)}))}},{key:"polling",value:function(){var e=this;this.killed||b("polling").query({uuid:this.data.uuid,version:this.data.version,diff:1,timeout:10}).end((function(t,o){null===o.body?setTimeout((function(){return e.polling()}),100):e.receive(o.body)}))}},{key:"receive",value:function(e){var t=this;if(!this.killed){if(e.books_diff){for(var o in Array.prototype.push.apply(this.data.books,e.books_diff.insert),e)e.hasOwnProperty(o)&&"books_diff"!==o&&(this.data[o]=e[o]);var r,n=i(e.books_diff.update);try{for(n.s();!(r=n.n()).done;){var s=r.value;for(var a in s)if(s.hasOwnProperty(a)&&"_idx"!==a)if(!0===Array.isArray(s[a]))Array.prototype.push.apply(this.data.books[s._idx][a],s[a]);else if(s[a]instanceof Object)for(var u in s[a])s[a].hasOwnProperty(u)&&(this.data.books[s._idx][a][u]=s[a][u]);else this.data.books[s._idx][a]=s[a]}}catch(l){n.e(l)}finally{n.f()}}else this.data=e;this.callback(this.data),!0===e.running?(console.log("[Unitrad] continue..."),1===e.version&&0===this.data.books.length?setTimeout((function(){return t.polling()}),20):setTimeout((function(){return t.polling()}),500)):console.log("[Unitrad] complete.")}}}]),e}();var m=function(e){!function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(o&&o.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),o&&t(e,o)}(n,e);var r=o(n);function n(e){var t;return a(this,n),(t=r.call(this,e)).state={invalidISBN:!1,books:[]},t.timer=null,t.str="",t.prevISBN=null,t.documentCode=null,t}return l(n,[{key:"onKeyDown",value:function(e){var t=this;if("Spreadsheet__data-editor"!==e.target.parentNode.className){var o=e||window.event,r=o.keyCode||o.which||o.charCode;console.log(this.str),console.log(e.key),"Enter"===e.key||13===r?(this.str.length>=10&&(h(this.str)?(this.setState({invalidISBN:!1}),this.addBook(this.str)):(this.setState({invalidISBN:!0}),this.pushTempBook(this.str))),this.str.match(/^[A-D][0-9]+[A-D]$/)&&(this.setState({invalidISBN:!0}),this.pushTempBook(this.str.replace(/[A-D]/g,""))),this.timer&&clearTimeout(this.timer),this.str=""):(1===e.key.length?this.str+=e.key:"Shift"===e.key||(this.str=""),this.timer&&clearTimeout(this.timer),this.timer=setTimeout((function(){console.log("clear"),t.str.length>=10&&(h(t.str)?(t.setState({invalidISBN:!1}),t.addBook(t.str)):(t.setState({invalidISBN:!0}),t.pushTempBook(t.str))),t.str=""}),300))}}},{key:"componentDidMount",value:function(){window.document.addEventListener("keydown",this.onKeyDown.bind(this))}},{key:"addBook",value:function(e){var t=this;this.api=new g({isbn:e,region:"recipe"},(function(e){if(e.count>=1){var o=e.books[0];t.pushBook(o)}else console.log("not found");t.api=null}))}},{key:"pushBook",value:function(e){var t=e.isbn,o=e.title,r=e.author,n=e.publisher,i=e.pubdate;this.prevISBN!==t&&(this.documentCode?(this.state.books.shift(),this.state.books.unshift([{value:this.documentCode},{value:t},{value:o},{value:r},{value:n},{value:i}]),this.documentCode=null):this.state.books.unshift([{value:t},{value:t},{value:o},{value:r},{value:n},{value:i}]),this.setState({}),this.prevISBN=t)}},{key:"pushTempBook",value:function(e){e.startsWith("192")||this.documentCode!==e&&(this.state.books.unshift([{value:e},{value:""},{value:""},{value:""},{value:""},{value:""}]),this.setState({}),this.documentCode=e)}},{key:"render",value:function(){return 0===this.state.books.length?u.createElement("div",{className:"description"},u.createElement("div",null,u.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},u.createElement("path",{d:"M0 448V64h18v384H0zm26.857-.273V64H36v383.727h-9.143zm27.143 0V64h8.857v383.727H54zm44.857 0V64h8.857v383.727h-8.857zm36 0V64h17.714v383.727h-17.714zm44.857 0V64h8.857v383.727h-8.857zm18 0V64h8.857v383.727h-8.857zm18 0V64h8.857v383.727h-8.857zm35.715 0V64h18v383.727h-18zm44.857 0V64h18v383.727h-18zm35.999 0V64h18.001v383.727h-18.001zm36.001 0V64h18.001v383.727h-18.001zm26.857 0V64h18v383.727h-18zm45.143 0V64h26.857v383.727h-26.857zm35.714 0V64h9.143v383.727H476zm18 .273V64h18v384h-18z"})),"バーコードをスキャンしてください")):u.createElement(d,{data:this.state.books,columnLabels:["id","isbn","タイトル","著者","出版社","出版年"]})}}]),n}(s.exports.Component);p.render(u.createElement(m,null),document.getElementById("app"))}}}))}();
