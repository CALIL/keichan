import{u as e,l as t,r as s,R as o,S as i,a as n}from"./vendor.84e7a553.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(s){const o=new URL(e,location),i=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((s,n)=>{const a=new URL(e,o);if(self[t].moduleMap[a])return s(self[t].moduleMap[a]);const h=new Blob([`import * as m from '${a}';`,`${t}.moduleMap['${a}']=m;`],{type:"text/javascript"}),r=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(h),onerror(){n(new Error(`Failed to import: ${e}`)),i(r)},onload(){s(self[t].moduleMap[a]),i(r)}});document.head.appendChild(r)})),self[t].moduleMap={}}}("/keichan/assets/");class a extends s.exports.Component{constructor(e){super(e),this.state={invalidISBN:!1,books:[]},this.timer=null,this.str="",this.prevISBN=null,this.documentCode=null}onKeyDown(e){if("Spreadsheet__data-editor"===e.target.parentNode.className)return;const t=e||window.event,s=t.keyCode||t.which||t.charCode;console.log(this.str),console.log(e.key),"Enter"===e.key||13===s?(this.checkStr(),this.timer&&clearTimeout(this.timer),this.str=""):(1===e.key.length?this.str+=e.key:"Shift"===e.key||(this.str=""),this.timer&&clearTimeout(this.timer),this.timer=setTimeout((()=>{console.log("clear"),this.checkStr(),this.str=""}),300))}checkStr(){!function(s){s=e.nfkc(s).toUpperCase().replace(/[^0-9X]/g,"");let o=t.parse(s);if(o){if(o.isIsbn10())return o.asIsbn10();if(o.isIsbn13())return o.asIsbn13().startsWith("978")?o.asIsbn10():o.asIsbn13()}else{let e=t.parse("978"+s);if(e&&e.isIsbn13())return e.asIsbn10()}return!1}(this.str)?(this.setState({invalidISBN:!0}),this.str.match(/^[A-D][0-9]+[A-D]$/)?this.pushTempBook(this.str.replace(/[A-D]/g,"")):this.pushTempBook(this.str)):(this.setState({invalidISBN:!1}),this.addBook(this.str))}componentDidMount(){window.document.addEventListener("keydown",this.onKeyDown.bind(this))}async addBook(e){const t=await fetch(`https://unitrad.calil.jp/v1/search?isbn=${e}&region=recipe`).then((e=>e.json()));if(t.count>=1){const e=t.books[0];this.pushBook(e)}else console.log("not found")}pushBook(e){const{isbn:t,title:s,author:o,publisher:i,pubdate:n}=e;this.prevISBN!==t&&(this.documentCode?(this.state.books.shift(),this.state.books.unshift([{value:this.documentCode},{value:t},{value:s},{value:o},{value:i},{value:n}]),this.documentCode=null):this.state.books.unshift([{value:t},{value:t},{value:s},{value:o},{value:i},{value:n}]),this.setState({}),this.prevISBN=t)}pushTempBook(e){e.startsWith("192")||this.documentCode!==e&&(this.state.books.unshift([{value:e},{value:""},{value:""},{value:""},{value:""},{value:""}]),this.setState({}),this.documentCode=e)}render(){return 0===this.state.books.length?o.createElement("div",{className:"description"},o.createElement("div",null,o.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},o.createElement("path",{d:"M0 448V64h18v384H0zm26.857-.273V64H36v383.727h-9.143zm27.143 0V64h8.857v383.727H54zm44.857 0V64h8.857v383.727h-8.857zm36 0V64h17.714v383.727h-17.714zm44.857 0V64h8.857v383.727h-8.857zm18 0V64h8.857v383.727h-8.857zm18 0V64h8.857v383.727h-8.857zm35.715 0V64h18v383.727h-18zm44.857 0V64h18v383.727h-18zm35.999 0V64h18.001v383.727h-18.001zm36.001 0V64h18.001v383.727h-18.001zm26.857 0V64h18v383.727h-18zm45.143 0V64h26.857v383.727h-26.857zm35.714 0V64h9.143v383.727H476zm18 .273V64h18v384h-18z"})),"バーコードをスキャンしてください")):o.createElement(i,{data:this.state.books,columnLabels:["id","isbn","タイトル","著者","出版社","出版年"]})}}n.render(o.createElement(a,null),document.getElementById("app"));
