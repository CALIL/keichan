!function(){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e,n,o,r,i,s){try{var u=t[i](s),a=u.value}catch(c){return void n(c)}u.done?e(a):Promise.resolve(a).then(o,r)}function n(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function o(t,e){return(o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function r(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,o=s(t);if(e){var r=s(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return i(this,n)}}function i(e,n){return!n||"object"!==t(n)&&"function"!=typeof n?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(e):n}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}System.register(["./index-legacy.1e384398.js","./vendor-legacy.8dc99ce6.js"],(function(){"use strict";var t,i,s,u,a,c;return{setters:[function(){},function(e){t=e.u,i=e.l,s=e.r,u=e.R,a=e.S,c=e.a}],execute:function(){var h=function(s){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&o(t,e)}(m,s);var c,h,l,f,v,p=r(m);function m(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,m),(e=p.call(this,t)).state={invalidISBN:!1,books:[]},e.timer=null,e.str="",e.prevISBN=null,e.documentCode=null,e}return c=m,(h=[{key:"onKeyDown",value:function(t){var e=this;if("Spreadsheet__data-editor"!==t.target.parentNode.className){var n=t||window.event,o=n.keyCode||n.which||n.charCode;console.log(this.str),console.log(t.key),"Enter"===t.key||13===o?(this.checkStr(),this.timer&&clearTimeout(this.timer),this.str=""):(1===t.key.length?this.str+=t.key:"Shift"===t.key||(this.str=""),this.timer&&clearTimeout(this.timer),this.timer=setTimeout((function(){console.log("clear"),e.checkStr(),e.str=""}),300))}}},{key:"checkStr",value:function(){!function(e){e=t.nfkc(e).toUpperCase().replace(/[^0-9X]/g,"");var n=i.parse(e);if(n){if(n.isIsbn10())return n.asIsbn10();if(n.isIsbn13())return n.asIsbn13().startsWith("978")?n.asIsbn10():n.asIsbn13()}else{var o=i.parse("978"+e);if(o&&o.isIsbn13())return o.asIsbn10()}return!1}(this.str)?(this.setState({invalidISBN:!0}),this.str.match(/^[A-D][0-9]+[A-D]$/)?this.pushTempBook(this.str.replace(/[A-D]/g,"")):this.pushTempBook(this.str)):(this.setState({invalidISBN:!1}),this.addBook(this.str))}},{key:"componentDidMount",value:function(){window.document.addEventListener("keydown",this.onKeyDown.bind(this))}},{key:"addBook",value:(f=regeneratorRuntime.mark((function t(e){var n,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("https://unitrad.calil.jp/v1/search?isbn=".concat(e,"&region=").concat("recipe")).then((function(t){return t.json()}));case 2:(n=t.sent).count>=1?(o=n.books[0],this.pushBook(o)):console.log("not found");case 4:case"end":return t.stop()}}),t,this)})),v=function(){var t=this,n=arguments;return new Promise((function(o,r){var i=f.apply(t,n);function s(t){e(i,o,r,s,u,"next",t)}function u(t){e(i,o,r,s,u,"throw",t)}s(void 0)}))},function(t){return v.apply(this,arguments)})},{key:"pushBook",value:function(t){var e=t.isbn,n=t.title,o=t.author,r=t.publisher,i=t.pubdate;this.prevISBN!==e&&(this.documentCode?(this.state.books.shift(),this.state.books.unshift([{value:this.documentCode},{value:e},{value:n},{value:o},{value:r},{value:i}]),this.documentCode=null):this.state.books.unshift([{value:e},{value:e},{value:n},{value:o},{value:r},{value:i}]),this.setState({}),this.prevISBN=e)}},{key:"pushTempBook",value:function(t){t.startsWith("192")||this.documentCode!==t&&(this.state.books.unshift([{value:t},{value:""},{value:""},{value:""},{value:""},{value:""}]),this.setState({}),this.documentCode=t)}},{key:"render",value:function(){return 0===this.state.books.length?u.createElement("div",{className:"description"},u.createElement("div",null,u.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},u.createElement("path",{d:"M0 448V64h18v384H0zm26.857-.273V64H36v383.727h-9.143zm27.143 0V64h8.857v383.727H54zm44.857 0V64h8.857v383.727h-8.857zm36 0V64h17.714v383.727h-17.714zm44.857 0V64h8.857v383.727h-8.857zm18 0V64h8.857v383.727h-8.857zm18 0V64h8.857v383.727h-8.857zm35.715 0V64h18v383.727h-18zm44.857 0V64h18v383.727h-18zm35.999 0V64h18.001v383.727h-18.001zm36.001 0V64h18.001v383.727h-18.001zm26.857 0V64h18v383.727h-18zm45.143 0V64h26.857v383.727h-26.857zm35.714 0V64h9.143v383.727H476zm18 .273V64h18v384h-18z"})),"バーコードをスキャンしてください")):u.createElement(a,{data:this.state.books,columnLabels:["id","isbn","タイトル","著者","出版社","出版年"]})}}])&&n(c.prototype,h),l&&n(c,l),m}(s.exports.Component);c.render(u.createElement(h,null),document.getElementById("app"))}}}))}();
