import"./index.e4a5871d.js";import{u as t,l as e,r as s,R as h,S as i,a as o}from"./vendor.26fce9b6.js";class n extends s.exports.Component{constructor(t){super(t),this.state={invalidISBN:!1,books:[]},this.timer=null,this.str="",this.prevISBN=null,this.documentCode=null}onKeyDown(t){if("Spreadsheet__data-editor"===t.target.parentNode.className)return;const e=t||window.event,s=e.keyCode||e.which||e.charCode;console.log(this.str),console.log(t.key),"Enter"===t.key||13===s?(this.checkStr(),this.timer&&clearTimeout(this.timer),this.str=""):(1===t.key.length?this.str+=t.key:"Shift"===t.key||(this.str=""),this.timer&&clearTimeout(this.timer),this.timer=setTimeout((()=>{console.log("clear"),this.checkStr(),this.str=""}),300))}checkStr(){!function(s){s=t.nfkc(s).toUpperCase().replace(/[^0-9X]/g,"");let h=e.parse(s);if(h){if(h.isIsbn10())return h.asIsbn10();if(h.isIsbn13())return h.asIsbn13().startsWith("978")?h.asIsbn10():h.asIsbn13()}else{let t=e.parse("978"+s);if(t&&t.isIsbn13())return t.asIsbn10()}return!1}(this.str)?(this.setState({invalidISBN:!0}),this.str.match(/^[A-D][0-9]+[A-D]$/)?this.pushTempBook(this.str.replace(/[A-D]/g,"")):this.pushTempBook(this.str)):(this.setState({invalidISBN:!1}),this.addBook(this.str))}componentDidMount(){window.document.addEventListener("keydown",this.onKeyDown.bind(this))}async addBook(t){const e=await fetch(`https://unitrad.calil.jp/v1/search?isbn=${t}&region=recipe`).then((t=>t.json()));if(e.count>=1){const t=e.books[0];this.pushBook(t)}else console.log("not found")}pushBook(t){const{isbn:e,title:s,author:h,publisher:i,pubdate:o}=t;this.prevISBN!==e&&(this.documentCode?(this.state.books.shift(),this.state.books.unshift([{value:this.documentCode},{value:e},{value:s},{value:h},{value:i},{value:o}]),this.documentCode=null):this.state.books.unshift([{value:e},{value:e},{value:s},{value:h},{value:i},{value:o}]),this.setState({}),this.prevISBN=e)}pushTempBook(t){t.startsWith("192")||this.documentCode!==t&&(this.state.books.unshift([{value:t},{value:""},{value:""},{value:""},{value:""},{value:""}]),this.setState({}),this.documentCode=t)}render(){return 0===this.state.books.length?h.createElement("div",{className:"description"},h.createElement("div",null,h.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},h.createElement("path",{d:"M0 448V64h18v384H0zm26.857-.273V64H36v383.727h-9.143zm27.143 0V64h8.857v383.727H54zm44.857 0V64h8.857v383.727h-8.857zm36 0V64h17.714v383.727h-17.714zm44.857 0V64h8.857v383.727h-8.857zm18 0V64h8.857v383.727h-8.857zm18 0V64h8.857v383.727h-8.857zm35.715 0V64h18v383.727h-18zm44.857 0V64h18v383.727h-18zm35.999 0V64h18.001v383.727h-18.001zm36.001 0V64h18.001v383.727h-18.001zm26.857 0V64h18v383.727h-18zm45.143 0V64h26.857v383.727h-26.857zm35.714 0V64h9.143v383.727H476zm18 .273V64h18v384h-18z"})),"バーコードをスキャンしてください")):h.createElement(i,{data:this.state.books,columnLabels:["id","isbn","タイトル","著者","出版社","出版年"]})}}o.render(h.createElement(n,null),document.getElementById("app"));
