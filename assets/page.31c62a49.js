import("data:text/javascript;base64,Cg==");import{n as e,a as t}from"./api.462ba066.js";import{r as a,R as n,T as l,C as s,E as c,c as r,l as i,a as m}from"./vendor.de6f6c87.js";let o="",u=null;const d=()=>{const[m,d]=a.exports.useState([]),[E,p]=a.exports.useState(null),[b,h]=a.exports.useState(null),[f,v]=a.exports.useState([]);a.exports.useState("gk-xxxxxxxxxxxxxxx");const[g,x]=a.exports.useState("isbn"),y=e=>((e,t)=>{console.log("onKeyDown");const a=e||window.event,n=a.keyCode||a.which||a.charCode;"Enter"===e.key||13===n?(t(o),u&&clearTimeout(u),o=""):(1===e.key.length?o+=e.key:"Shift"===e.key||(o=""),u&&clearTimeout(u),u=setTimeout((()=>{t(o),o=""}),300))})(e,N);a.exports.useEffect((()=>(window.addEventListener("keydown",y),()=>{window.removeEventListener("keydown",y)})),[g,m]),a.exports.useEffect((()=>{const e=m[m.length-1];p(e)}),[m]);const N=async t=>{const a=e(t);if(a){const e=await w(a);if(e)if(console.log(e),e.type="book","isbn"===g){const t={id:e.isbn,items:[e]};d([...m,t])}else if("management"===g){const t=[...m],a=t[t.length-1];0===a.items.length?(a.items.push(e),console.log(t),d(t)):alert("次は資料番号のバーコードを読んでください")}}else{if(null!==t.match(/^192/))return;x("management"),d([...m,{id:t,items:[]}])}},k=e=>e.isbn,w=async a=>new Promise((async(n,l)=>{const s=new t({isbn:a,region:"recipe"},(async t=>{if(t.count>=1){s.kill();const a=t.books[0],l={id:a.id,title:a.title,author:a.author,publisher:a.publisher,pubdate:a.pubdate,isbn:a.isbn,tags:[]};l.bibHash=k(l);let c=i.parse(e(l.isbn));l.isbn=c.asIsbn13();const r=await T([l.isbn]);null!==r[0]?n(r[0]):n(l)}else!1===t.running&&0===t.count&&l()}))})),T=async e=>new Promise((async(t,a)=>{const n=await fetch("https://api.openBD.jp/v1/get?isbn="+e.join(",")).then((e=>e.json())),l=[];n.forEach((e=>{if(e){const t=[];try{e.onix.DescriptiveDetail.Collection.TitleDetail.TitleElement.forEach(((e,a)=>{t.includes(e.TitleText.content)||t.push(e.TitleText.content)}))}catch{}let a=e.summary.volume;try{""===a&&(a=e.onix.DescriptiveDetail.TitleDetail.TitleElement.PartNumber)}catch{}const n={title:[e.summary.title,a].join(" "),author:e.summary.author,publisher:e.summary.publisher,isbn:e.summary.isbn,pubdate:e.summary.pubdate,cover:e.summary.cover,tags:t};n.bibHash=k(n),l.push(n)}})),t(l)}));return n.createElement("div",{id:"new"},n.createElement("header",null,n.createElement("h1",null,"カーリルtoolbox: keichan","management"===g?n.createElement("span",{className:"mode"},"資料コード"):null)),n.createElement("main",null,n.createElement("div",{className:"left"},n.createElement("div",{className:"barcode active"},n.createElement(l,{large:!0,className:"tag"},"100014")),n.createElement("div",{className:"barcode"},n.createElement(l,{large:!0,className:"tag"},"100013"),n.createElement("p",null,"SPY×FAMILY 1")),n.createElement("div",{className:"barcode"},n.createElement(l,{large:!0,className:"tag"},"100012"),n.createElement("p",null,"1Q84 Book2"))),n.createElement("div",{className:"main"},E?n.createElement(n.Fragment,null,"management"===g?n.createElement(s,{key:"managementCode",className:"card active",interactive:!0,elevation:c.TWO},n.createElement("div",null,n.createElement(l,{className:"tag",large:!0},E.id),n.createElement(l,{className:"tag"},"管理バーコード")),n.createElement(r,{icon:"delete",size:25,color:"#ffffff"})):null,E.items.map(((e,t)=>{if("book"===e.type)return n.createElement(s,{key:e.bibHash,className:"card indent",interactive:!0,elevation:c.TWO},n.createElement("div",null,n.createElement(l,{className:"tag"},e.type),n.createElement(l,{className:"tag"},e.isbn),n.createElement("h3",null,e.title),e.cover?n.createElement("img",{className:"thumbnail",src:e.cover,alt:""}):null),n.createElement(r,{icon:"delete",size:25,color:"#ffffff"}))}))):null,b&&f.length>0?n.createElement("div",{className:"nextBook"},n.createElement("h2",null,"もしかして",n.createElement("span",null,"(",b.title+""+b.volume,"より推定)")),n.createElement("div",{className:"cards"},f.map((e=>n.createElement(s,{key:e.isbn,className:"card",interactive:!0,elevation:c.TWO},n.createElement("div",{className:"card-header"},e.cover?n.createElement("img",{src:e.cover,alt:e.title}):null,n.createElement("div",null,n.createElement("h3",null,[e.title,e.volume].join(" ")),n.createElement("p",{className:"author"},e.author),e.tags.map((e=>n.createElement(l,null,e))),n.createElement("p",null,e.isbn))),n.createElement(r,{icon:"add",size:25,color:"#ffffff"})))))):null)))};m.render(n.createElement(d,null),document.getElementById("app"));
