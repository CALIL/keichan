import("data:text/javascript;base64,Cg==");import{n as e,a as t}from"./api.d1fb3ac6.js";import{r as a,R as n,O as i,c as l,T as r,C as c,E as s,l as h,a as m}from"./vendor.4ba88960.js";let o="",d=null;const u=()=>{const[m,u]=a.exports.useState([]),[E,g]=a.exports.useState(null),[y,x]=a.exports.useState(null),[p,w]=a.exports.useState([]);a.exports.useState("gk-xxxxxxxxxxxxxxx");const[b,f]=a.exports.useState("isbn"),[v,k]=a.exports.useState(!0),[N,T]=a.exports.useState({show:!1,message:""}),S=e=>((e,t)=>{const a=e||window.event,n=a.keyCode||a.which||a.charCode;"Enter"===e.key||13===n?(t(o),d&&clearTimeout(d),o=""):(1===e.key.length?o+=e.key:"Shift"===e.key||(o=""),d&&clearTimeout(d),d=setTimeout((()=>{t(o),o=""}),300))})(e,j);a.exports.useEffect((()=>(window.addEventListener("keydown",S),()=>{window.removeEventListener("keydown",S)})),[b,m,v]),a.exports.useEffect((()=>{const e=m[m.length-1];g(e)}),[m]),a.exports.useEffect((()=>{setTimeout((()=>{T({show:!1,message:""})}),3e3)}),[N]);const j=async t=>{if(!1===v)return;const a=e(t);if(a){const e=await C(a);if(e)if(console.log(e),e.type="book","isbn"===b){const t={id:e.isbn,items:[e]};u([...m,t])}else if("management"===b){const t=[...m],a=t[t.length-1];0===a.items.length?(a.items.push(e),console.log(t),u(t)):T({show:!0,message:"次は資料コードのバーコードを読んでください"})}}else{if(null!==t.match(/^192/))return;if(null===t.match(/[a-zA-Z0-9]+/))return;t.match(/^[a-zA-Z](\d+)[a-zA-Z]$/)&&(t=RegExp.$1),f("management");const e=m[m.length-1];if(console.log(e),e&&0===e.items.length)return e.id=t,void u([...m]);if(m.filter((e=>e.id===t)).length>0)return void T({show:!0,message:"すでに登録済みの資料コードです"});if(u([...m,{id:t,items:[]}]),e&&e.items.length>0){const t=e.items.filter((e=>"book"===e.type));if(console.log(t),t.length>0){x(t[0]);const e=await D(t[0]);w(e)}}}k(!1),setTimeout((()=>k(!0)),100)},z=e=>e.isbn,C=async a=>(x(null),w([]),new Promise((async(n,i)=>{const l=new t({isbn:a,region:"recipe"},(async t=>{if(t.count>=1){l.kill();const a=t.books[0],i={id:a.id,title:a.title,author:a.author,publisher:a.publisher,pubdate:a.pubdate,isbn:a.isbn,tags:[]};i.bibHash=z(i);let r=h.parse(e(i.isbn));i.isbn=r.asIsbn13();const c=await B([i.isbn]);null!==c[0]?n(c[0]):n(i)}else!1===t.running&&0===t.count&&i()}))}))),D=async a=>{const n=a.author.split(",")[0],i=a.publisher,l=a.pubdate;return new Promise((async(r,c)=>{let s=new t({author:n,publisher:i,year_start:l,region:"recipe"},(async t=>{if(!s.killed&&(t.count>5&&s.kill(),console.log(t),t.count>=1)){const n=[];t.books.forEach((t=>{if(null===t.isbn)return;let a=0;t.pubdate&&(a="string"!=typeof t.pubdate?t.pubdate:Number(t.pubdate.split("/")[0].split(".")[0]));let i=h.parse(e(t.isbn)),l=null;try{l=i.asIsbn13()}catch{}l&&n.push({title:t.title+" "+t.volume,author:t.author.split(",")[0],publisher:t.publisher,isbn:l,pubdate:a})})),n.sort((function(e,t){return e.isbn<t.isbn?-1:e.isbn>t.isbn?1:0}));let i=[];const l=[];let c=!1;n.forEach((e=>{e.isbn!==a.isbn&&(c?i.push(e):l.push(e)),e.isbn===a.isbn&&(c=!0)})),i=i.concat(l);const s=[];i.forEach((e=>{s.push(e.isbn)}));const m=await B(s);r(m)}}))}))},B=async e=>new Promise((async(t,a)=>{const n=await fetch("https://api.openBD.jp/v1/get?isbn="+e.join(",")).then((e=>e.json())),i=[];n.forEach((e=>{if(e){const t=[];try{e.onix.DescriptiveDetail.Collection.TitleDetail.TitleElement.forEach(((e,a)=>{t.includes(e.TitleText.content)||t.push(e.TitleText.content)}))}catch{}let a=e.summary.volume;try{""===a&&(a=e.onix.DescriptiveDetail.TitleDetail.TitleElement.PartNumber)}catch{}const n={title:[e.summary.title,a].join(" "),author:e.summary.author,publisher:e.summary.publisher,isbn:e.summary.isbn,pubdate:e.summary.pubdate,cover:e.summary.cover,tags:t};n.bibHash=z(n),i.push(n)}})),t(i)}));return n.createElement("div",{id:"new"},n.createElement(i,{isOpen:N.show,onClose:()=>T({show:!1,message:""}),hasBackdrop:!1},n.createElement("div",{className:"bp3-card bp3-elevation-4 bp3-overlay-content"},n.createElement(l,{icon:"tick",size:25,color:"#000000"}),N.message)),n.createElement("header",null,n.createElement("h1",null,"カーリルtoolbox: keichan","management"===b?n.createElement("span",{className:"mode"},"資料コード"):null)),n.createElement("main",null,n.createElement("div",{className:"left"},m.slice().reverse().map(((e,t)=>n.createElement("div",{key:e.id,className:"barcode"},n.createElement(r,{large:!0,className:"tag"},e.id),e.items.map(((e,t)=>{if("book"===e.type)return n.createElement("p",null,e.title)})))))),n.createElement("div",{className:"main"},E?n.createElement(n.Fragment,null,"management"===b?n.createElement(c,{key:"managementCode",className:"card active",interactive:!0,elevation:s.TWO},n.createElement("div",null,n.createElement(r,{className:"tag",large:!0},E.id),n.createElement(r,{className:"tag"},"管理バーコード")),n.createElement(l,{icon:"delete",size:25,color:"#ffffff"})):null,E.items.map(((e,t)=>{if("book"===e.type)return n.createElement(c,{key:e.bibHash,className:"card indent",interactive:!0,elevation:s.TWO},n.createElement("div",null,n.createElement(r,{className:"tag"},e.type),n.createElement(r,{className:"tag"},e.isbn),n.createElement("h3",null,e.title),e.cover?n.createElement("img",{className:"thumbnail",src:e.cover,alt:""}):null),n.createElement(l,{icon:"delete",size:25,color:"#ffffff"}))}))):null,y&&p.length>0?n.createElement("div",{className:"nextBook"},n.createElement("h2",null,"もしかして",n.createElement("span",null,"(",y.title,"より推定)")),n.createElement("div",{className:"cards"},p.map((e=>n.createElement(c,{key:e.isbn,className:"card",interactive:!0,elevation:s.TWO},n.createElement("div",{className:"card-header"},e.cover?n.createElement("img",{src:e.cover,alt:e.title}):null,n.createElement("div",null,n.createElement("h3",null,[e.title,e.volume].join(" ")),n.createElement("p",{className:"author"},e.author),e.tags.map((e=>n.createElement(r,null,e))),n.createElement("p",null,e.isbn),n.createElement("svg",{version:"1.1",width:"273px",height:"40px",x:"0px",y:"0px",viewBox:"0 0 273 40",style:{transform:"translate(0,0)"}},n.createElement("rect",{x:0,y:0,width:273,height:40,style:{fill:"#ffffff"}}),n.createElement("g",{transform:"translate(0, 0)",style:{fill:"#000000"}},n.createElement("rect",{x:0,y:0,width:"2.25",height:40}),n.createElement("rect",{x:"4.5",y:0,width:"4.5",height:40}),n.createElement("rect",{x:"13.5",y:0,width:"2.25",height:40}),n.createElement("rect",{x:"20.25",y:0,width:"2.25",height:40}),n.createElement("rect",{x:"24.75",y:0,width:"2.25",height:40}),n.createElement("rect",{x:"29.25",y:0,width:"4.5",height:40}),n.createElement("rect",{x:36,y:0,width:"2.25",height:40}),n.createElement("rect",{x:"42.75",y:0,width:"2.25",height:40}),n.createElement("rect",{x:"47.25",y:0,width:"2.25",height:40}),n.createElement("rect",{x:"51.75",y:0,width:"2.25",height:40}),n.createElement("rect",{x:"56.25",y:0,width:"2.25",height:40}),n.createElement("rect",{x:63,y:0,width:"4.5",height:40}),n.createElement("rect",{x:"69.75",y:0,width:"2.25",height:40}),n.createElement("rect",{x:"76.5",y:0,width:"4.5",height:40}),n.createElement("rect",{x:"83.25",y:0,width:"2.25",height:40}),n.createElement("rect",{x:"87.75",y:0,width:"2.25",height:40}),n.createElement("rect",{x:"92.25",y:0,width:"2.25",height:40}),n.createElement("rect",{x:99,y:0,width:"2.25",height:40}),n.createElement("rect",{x:"103.5",y:0,width:"4.5",height:40}),n.createElement("rect",{x:"110.25",y:0,width:"2.25",height:40}),n.createElement("rect",{x:"114.75",y:0,width:"2.25",height:40}),n.createElement("rect",{x:"119.25",y:0,width:"2.25",height:40}),n.createElement("rect",{x:"123.75",y:0,width:"2.25",height:40}),n.createElement("rect",{x:"130.5",y:0,width:"4.5",height:40}),n.createElement("rect",{x:"137.25",y:0,width:"4.5",height:40}),n.createElement("rect",{x:"146.25",y:0,width:"2.25",height:40}),n.createElement("rect",{x:"150.75",y:0,width:"2.25",height:40}),n.createElement("rect",{x:"155.25",y:0,width:"2.25",height:40}),n.createElement("rect",{x:"159.75",y:0,width:"4.5",height:40}),n.createElement("rect",{x:"166.5",y:0,width:"2.25",height:40}),n.createElement("rect",{x:171,y:0,width:"2.25",height:40}),n.createElement("rect",{x:"177.75",y:0,width:"2.25",height:40}),n.createElement("rect",{x:"182.25",y:0,width:"2.25",height:40}),n.createElement("rect",{x:"186.75",y:0,width:"2.25",height:40}),n.createElement("rect",{x:"191.25",y:0,width:"4.5",height:40}),n.createElement("rect",{x:"200.25",y:0,width:"2.25",height:40}),n.createElement("rect",{x:"204.75",y:0,width:"2.25",height:40}),n.createElement("rect",{x:"209.25",y:0,width:"2.25",height:40}),n.createElement("rect",{x:216,y:0,width:"2.25",height:40}),n.createElement("rect",{x:"220.5",y:0,width:"4.5",height:40}),n.createElement("rect",{x:"227.25",y:0,width:"4.5",height:40}),n.createElement("rect",{x:"236.25",y:0,width:"2.25",height:40}),n.createElement("rect",{x:"240.75",y:0,width:"2.25",height:40}),n.createElement("rect",{x:"245.25",y:0,width:"2.25",height:40}),n.createElement("rect",{x:"249.75",y:0,width:"2.25",height:40}),n.createElement("rect",{x:"254.25",y:0,width:"4.5",height:40}),n.createElement("rect",{x:"263.25",y:0,width:"2.25",height:40}),n.createElement("rect",{x:270,y:0,width:"2.25",height:40}))))),n.createElement(l,{icon:"add",size:25,color:"#ffffff"})))))):null)))};m.render(n.createElement(u,null),document.getElementById("app"));
