import("data:text/javascript;base64,Cg==");import{n as e,a as t}from"./api.4c34004d.js";import{r as a,l as n,R as l,T as s,C as r,E as c,c as o,a as i}from"./vendor.de6f6c87.js";const m=i=>{let m="",u=null;const[d,p]=a.exports.useState(null),[b,E]=a.exports.useState([]);a.exports.useEffect((()=>{window.document.addEventListener("keydown",h)}),[]),a.exports.useEffect((()=>{window.document.addEventListener("keydown",h)}),[]);const h=e=>{const t=e||window.event,a=t.keyCode||t.which||t.charCode;"Enter"===e.key||13===a?(f(),u&&clearTimeout(u),m=""):(1===e.key.length?m+=e.key:"Shift"===e.key||(m=""),u&&clearTimeout(u),u=setTimeout((()=>{console.log("clear"),f(),m=""}),300))},f=async()=>{const t=e(m);if(t){const e=await v(t);e&&(p(e),await g(e))}},v=async a=>(p(null),E([]),new Promise((async(l,s)=>{const r=new t({isbn:a,region:"recipe"},(t=>{if(console.log(t),t.count>=1){r.kill();const a=t.books[0];let s=n.parse(e(a.isbn));a.isbn=s.asIsbn13(),l(a)}else!1===t.running&&0===t.count&&s()}))}))),g=async a=>{const l=a.author.split(",")[0],s=a.publisher,r=a.pubdate;let c=new t({author:l,publisher:s,year_start:r,region:"recipe"},(async t=>{if(!c.killed&&(t.count>5&&c.kill(),console.log(t),t.count>=1)){const l=[];t.books.forEach((t=>{if(null===t.isbn)return;let a=0;t.pubdate&&(a="string"!=typeof t.pubdate?t.pubdate:Number(t.pubdate.split("/")[0].split(".")[0]));let s=n.parse(e(t.isbn)),r=null;try{r=s.asIsbn13()}catch{}r&&l.push({title:t.title+" "+t.volume,author:t.author.split(",")[0],publisher:t.publisher,isbn:r,pubdate:a})})),l.sort((function(e,t){return e.isbn<t.isbn?-1:e.isbn>t.isbn?1:0}));const s=[];let r=!1;l.forEach((e=>{r&&s.push(e),e.isbn===a.isbn&&(r=!0)}));const c=[];s.forEach((e=>{c.push(e.isbn)}));const o=await fetch("https://api.openbd.jp/v1/get?isbn="+c.join(",")).then((e=>e.json()));console.log(o);const i=[];return o.forEach((e=>{if(e){const t={title:e.summary.title,author:e.summary.author,publisher:e.summary.publisher,isbn:e.summary.isbn,pubdate:e.summary.pubdate,cover:e.summary.cover};i.push(t)}})),E(i)}}))};return l.createElement("div",{id:"suggests"},l.createElement("header",null,l.createElement("h1",null,"カーリルtoolbox: keichan")),l.createElement("main",null,l.createElement("div",{className:"left"},l.createElement("div",{className:"barcode active"},l.createElement(s,{large:!0,className:"tag"},"100014")),l.createElement("div",{className:"barcode"},l.createElement(s,{large:!0,className:"tag"},"100013"),l.createElement("p",null,"SPY×FAMILY 1")),l.createElement("div",{className:"barcode"},l.createElement(s,{large:!0,className:"tag"},"100012"),l.createElement("p",null,"1Q84 Book2"))),l.createElement("div",{className:"main"},l.createElement(r,{className:"card active",interactive:!0,elevation:c.TWO},l.createElement("div",null,l.createElement(s,{className:"tag",large:!0},"100014"),l.createElement(s,{className:"tag"},"管理バーコード")),l.createElement(o,{icon:"delete",size:25,color:"#ffffff"})),d&&b.length>0?l.createElement("div",{className:"nextBook"},l.createElement("h2",null,"もしかして",l.createElement("span",null,"(",d.title+""+d.volume,"より推定)")),l.createElement("div",{className:"cards"},b.map((e=>l.createElement(r,{key:e.isbn,className:"card",interactive:!0,elevation:c.TWO},l.createElement("div",{className:"card-header"},e.cover?l.createElement("img",{src:e.cover,alt:e.title}):null,l.createElement("div",null,l.createElement("h3",null,[e.title,e.volume].join(" ")),l.createElement("p",{className:"author"},e.author),l.createElement("p",null,e.pubdate),l.createElement("p",null,e.publisher))),l.createElement(o,{icon:"add",size:25,color:"#ffffff"})))))):null)))};i.render(l.createElement(m,null),document.getElementById("app"));
